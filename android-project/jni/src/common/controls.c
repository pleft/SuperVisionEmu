
#include <stdlib.h>
#include <stdio.h>
#include "controls.h"
#include "SDL.h"


uint8 controls_state;

////////////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////////////
//
//
//
//
//
////////////////////////////////////////////////////////////////////////////////
void controls_init()
{
	//fprintf(log_get(), "controls: init\n");
}
////////////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////////////
//
//
//
//
//
////////////////////////////////////////////////////////////////////////////////
void controls_done()
{
	//fprintf(log_get(), "controls: done\n");
}
////////////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////////////
//
//
//
//
//
////////////////////////////////////////////////////////////////////////////////
void controls_reset()
{
	//fprintf(log_get(), "controls: reset\n");
	controls_state = 0x00;
}
////////////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////////////
//
//
//
//
//
////////////////////////////////////////////////////////////////////////////////
void controls_write(uint32 addr, uint8 data)
{
}

void controls_state_write(uint8 type, uint8 data)
{
     if(controls_state==data) 
        return; 
     else 
        controls_state = 0;
     
     if(type)
       controls_state|=data;
     else
       controls_state=data;
}
////////////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////////////
//
//
//
//
//
////////////////////////////////////////////////////////////////////////////////
uint8 controls_read(uint32 addr)
{
	return(controls_state^0xff); 
}
////////////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////////////
//
//
//
//
//
////////////////////////////////////////////////////////////////////////////////
BOOL controls_update(void)
{
//	controls_state = 0;
    SDL_Event event;

	// Check for events
	while( SDL_PollEvent( &event ) )
	{
	    switch( event.type )
		{
			case SDL_KEYDOWN:
				switch( event.key.keysym.sym )
				{
					case SDLK_RIGHT:
					    SDL_Log("SDLK_RIGHT");
                        controls_state|=0x01;
						break;
					case SDLK_LEFT:
					    SDL_Log("SDLK_LEFT");
                        controls_state|=0x02;
						break;
					case SDLK_DOWN:
					    SDL_Log("SDLK_DOWN");
                        controls_state|=0x04;
						break;
					case SDLK_UP:
					    SDL_Log("SDLK_UP");
                        controls_state|=0x08;
						break;
					case SDLK_x:
					    SDL_Log("SDLK_A");
                        controls_state|=0x10;
						break;
					case SDLK_c:
					    SDL_Log("SDLK_B");
                        controls_state|=0x20;
						break;
					case SDLK_F1:
					    SDL_Log("SDLK_SELECT");
                        controls_state|=0x40;
						break;
					case SDLK_F2:
					    SDL_Log("SDLK_START");
                        controls_state|=0x80;
						break;
					default:
						break;
				}
			break;
			case SDL_KEYUP:
			controls_state = 0;
			break;
		}
	}
	return(TRUE);
}
